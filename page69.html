<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minification Comparator</title>
    <style>
        /* Mobile-First Base Styles */
        body {
            font-family: monospace;
            background-color: #282c34;
            color: #abb2bf;
            margin: 10px;
            padding: 10px;
        }
        h1 {
            color: #61afef;
            border-bottom: 2px solid #56b6c2;
            padding-bottom: 5px;
            font-size: 1.5em;
        }
        p, .output-label {
            font-size: 0.9em;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 8px;
            margin-bottom: 15px;
            box-sizing: border-box;
            background-color: #3e4451;
            color: #abb2bf;
            border: 1px solid #5c6370;
            resize: vertical;
            font-family: monospace;
            font-size: 0.85em;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #98c379;
            color: #282c34;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-bottom: 20px;
        }
        button:hover { background-color: #a7d389; }
        .output-container { margin-top: 10px; }
        .output-label { color: #e5c07b; margin-bottom: 5px; display: block; }

        /* Flex container for output controls */
        .output-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        /* Copy Button specific styles */
        #copyButton {
            width: auto;
            padding: 5px 10px;
            background-color: #56b6c2;
            color: #fff;
            font-size: 0.8em;
            margin: 0;
            transition: background-color 0.3s, transform 0.1s;
        }
        #copyButton:hover {
            background-color: #61afef;
        }

        /* Utility class for feedback */
        .copied {
            background-color: #98c379 !important;
            transform: scale(1.05);
        }

        /* Comparison Data Display */
        .comparison-data {
            background-color: #3e4451;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        .comparison-data span {
            display: block;
            padding: 3px 0;
        }
        .red { color: #ff6c6b; }
    </style>
</head>
<body>

    <h1>Constraint-Based Minification üìè</h1>
    <p>The tool uses variable shortening and text dictionary compression.</p>

    <h2>Input (Original Code)</h2>
    <textarea id="inputCode">
/* Original identifier names: container, float */
.container { 
    width: 100%; 
    animation: float 2s; 
    border-radius: 5px;
} 

@keyframes float { 
    0% { transform: translateY(0); } 
}

/* This repeated text pattern makes a good candidate for dictionary compression! */
/* This repeated text pattern makes a good candidate for dictionary compression! */
    </textarea>

    <button onclick="processCode()">Process Code & Compare Sizes</button>

    <div class="comparison-data">
        <span id="originalSize">Original Size: 0 Bytes</span>
        <span id="minifiedSize">Minified Size: 0 Bytes</span>
        <span id="reductionPercent">Reduction: 0%</span>
    </div>

    <div class="output-container">
        <div class="output-controls">
            <span class="output-label">Output (Compressed & Edited)</span>
            <button id="copyButton" onclick="copyCode()">Copy</button>
        </div>
        <textarea id="outputCode" readonly></textarea>
    </div>

    <script>
        // --- Algorithmic Compression Maps ---

        // Map 1: Variable/Identifier Shortening (Max 2 chars)
        const identifierMap = {
            'container': 'c',
            'float': 'f',
            'glitch1': 'g1',
            'glitch2': 'g2',
        };

        // Map 2: Common Text/String Dictionary Compression
        // Keys are common long strings; Values are short, unused placeholders.
        const textMap = {
            // Shorten CSS property
            'border-radius': 'BR',
            // Shorten repeated long string (from comments in the example input)
            'This repeated text pattern makes a good candidate for dictionary compression!': 'TEXT-KEY',
        };

        // --- Core Compression Functions ---
        
        function applyReplacements(code, map) {
            let processedCode = code;
            // Iterate through the map and replace
            for (const original in map) {
                const minified = map[original];
                
                // Use a non-word-boundary replacement for the text map to catch partial phrases/strings
                // Use a global flag for all replacements
                const regex = new RegExp(original, 'g'); 
                processedCode = processedCode.replace(regex, minified);
            }
            return processedCode;
        }

        function applyMinification(code) {
            let minified = code.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g, ''); // 1. Remove comments
            minified = minified.replace(/\s+/g, ' '); // 2. Consolidate whitespace
            minified = minified.replace(/\s?([;{}])\s?/g, '$1'); // 3. Remove spaces around delimiters
            minified = minified.replace(/\s?:\s?/g, ':'); // 4. Remove spaces around colons
            minified = minified.replace(/,\s/g, ','); // 5. Remove spaces after commas
            
            // 6. Add CSS Shorthand Optimization for 0 values
            minified = minified.replace(/([: ])0(px|em|pt|rem|vh|vw)/g, '$1 0');

            return minified.trim();
        }

        // --- Size Comparison Logic ---
        function getSizeInBytes(str) {
            return new Blob([str]).size;
        }

        function updateComparison(originalStr, minifiedStr) {
            const originalBytes = getSizeInBytes(originalStr);
            const minifiedBytes = getSizeInBytes(minifiedStr);
            const reduction = originalBytes - minifiedBytes;
            let percent = 0;

            if (originalBytes > 0) {
                percent = ((reduction / originalBytes) * 100).toFixed(2);
            }
            
            document.getElementById('originalSize').textContent = `Original Size: ${originalBytes} Bytes`;
            document.getElementById('minifiedSize').textContent = `Compressed Size: ${minifiedBytes} Bytes`;
            
            const reductionElement = document.getElementById('reductionPercent');
            reductionElement.textContent = `Reduction: ${percent}%`;
            reductionElement.classList.toggle('red', percent > 0);
        }

        // --- Copy to Clipboard Logic ---
        function copyCode() {
            const outputElement = document.getElementById('outputCode');
            const copyButton = document.getElementById('copyButton');
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(outputElement.value).then(() => {
                    copyButton.textContent = 'Copied!';
                    copyButton.classList.add('copied');
                    setTimeout(() => {
                        copyButton.textContent = 'Copy';
                        copyButton.classList.remove('copied');
                    }, 1500);
                }).catch(err => {
                    alert('Copy failed.');
                });
            } else {
                outputElement.select();
                document.execCommand('copy');
                copyButton.textContent = 'Copied!';
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.textContent = 'Copy';
                    copyButton.classList.remove('copied');
                }, 1500);
            }
        }

        // --- Main Execution Function ---
        function processCode() {
            const inputElement = document.getElementById('inputCode');
            const outputElement = document.getElementById('outputCode');
            const inputCode = inputElement.value;

            // Step 1: Algorithmic Constraint-Based Editing (Variable Shortening)
            let processedCode = applyReplacements(inputCode, identifierMap);
            
            // Step 2: Advanced Dictionary Compression (Text Shortening)
            processedCode = applyReplacements(processedCode, textMap);

            // Step 3: Standard Minification (Whitespace, Comments, Syntax)
            let minifiedCode = applyMinification(processedCode);
            
            // Step 4: Comparison and Display
            updateComparison(inputCode, minifiedCode);
            outputElement.value = minifiedCode;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', processCode);
    </script>

</body>
</html>
