<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1,minimum-scale=1,viewport-fit=cover">
<title>Santaslileper OS</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">

<style>
/* --- CORE --- */
*{margin:0;padding:0;box-sizing:border-box}
body,html{touch-action:none;overscroll-behavior:none;height:100%;overflow:hidden;background:#000}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;user-select:none;-webkit-user-select:none}

.p{position:relative;width:100%;height:100%;background-color:#050505;overflow:hidden;display:flex;flex-direction:column}
@media(min-width:768px){.p{max-width:375px;max-height:812px;margin:20px auto;border-radius:50px;box-shadow:0 0 0 12px #2c2c2e;border:1px solid #333}}

/* --- SYSTEM UI --- */
.s{position:relative;width:100%;height:100%;z-index:2}
.sb{height:44px;padding:0 20px;display:flex;align-items:flex-end;justify-content:space-between;padding-bottom:8px;color:#fff;font-size:15px;font-weight:600;z-index:100;pointer-events:none;position:absolute;width:100%;top:0}

/* HOME INDICATOR */
.hi {position: absolute; bottom: 0; left: 0; width: 100%; height: 40px; display: flex; justify-content: center; align-items: center; z-index: 10000; pointer-events: auto; touch-action: none;}
.hi::before{content:'';display:block;width:140px;height:5px;background:rgba(255,255,255,.7);border-radius:3px;box-shadow: 0 1px 4px rgba(0,0,0,0.5);}

/* --- GRID SYSTEM --- */
.h{position:absolute;top:0;left:0;right:0;bottom:0;padding-top:60px;transition:transform .4s,filter .4s;overflow-y:auto;overflow-x:hidden;display:block}
.h.zo{transform:scale(.85);filter:brightness(.6)blur(5px);pointer-events:none}
#ag{position:relative;width:100%;min-height:100vh;padding-bottom:200px}

/* ITEMS */
.grid-item{position:absolute;transition:left .3s cubic-bezier(.34,1.56,.64,1),top .3s cubic-bezier(.34,1.56,.64,1);touch-action:none;z-index:10}
.grid-item.resizing{transition:none;z-index:100;opacity:.9;background:rgba(44,44,46,.9)!important;border:1px solid #007aff!important;border-radius:20px}
.edit-mode .grid-item:not(.resizing):not(.dragging){animation:jiggle .3s infinite linear;cursor:grab}
.edit-mode .grid-item.dragging{z-index:100;animation:none;transform:scale(1.1);opacity:.8;transition:none}
@keyframes jiggle{0%{transform:rotate(-1.5deg)}50%{transform:rotate(1.5deg)}100%{transform:rotate(-1.5deg)}}

/* ICONS & COLORS */
.aiw{width:80px;height:95px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
.ai{width:60px;height:60px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:30px;color:#fff;box-shadow:0 4px 10px rgba(0,0,0,.3);background:linear-gradient(135deg,#333,#555)}

.ai.files { background: linear-gradient(135deg, #1CB5E0 0%, #000851 100%); }
.ai.news { background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 99%, #93a5cf 100%); }
.ai.info { background: linear-gradient(135deg, #e1eec3 0%, #f05053 100%); }
.ai.chat { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.ai.mortis { background: linear-gradient(135deg, #434343 0%, #000000 100%); border: 1px solid #444; }
.ai.ai-learn { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
.ai.themes { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
.ai.test { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
.ai.grapple { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
.ai.cycles { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
.ai.settings { background: linear-gradient(135deg, #cfd9df 0%, #e2ebf0 100%); color:#333; }
.ai.calc { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.ai.motion { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.ai.torch { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
.ai.speaker { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
.ai.touch { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
.ai.camera { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
.ai.mic { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }


.al{color:#fff;font-size:11px;margin-top:5px;text-shadow:0 1px 2px rgba(0,0,0,.8);text-align:center;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* WIDGETS */
.widget{background:0 0;backdrop-filter:none;border:none;border-radius:20px;overflow:hidden;color:#fff;display:flex;flex-direction:column;transition:background .3s,border .3s,backdrop-filter .3s}
.edit-mode .widget{background:rgba(30,41,59,.6);backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,.15);box-shadow:0 4px 15px rgba(0,0,0,.3)}
.widget-content{flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:10px;text-align:center;width:100%;height:100%;overflow:hidden;text-shadow:0 2px 8px rgba(0,0,0,.6)}
.del-btn{position:absolute;top:-8px;left:-8px;width:24px;height:24px;background:#ff3b30;border-radius:50%;display:none;z-index:20;color:#fff;font-weight:700;font-size:16px;align-items:center;justify-content:center;box-shadow:0 2px 5px rgba(0,0,0,.3)}
.resize-handle{position:absolute;bottom:0;right:0;width:40px;height:40px;z-index:30;display:none;touch-action:none}
.resize-handle::after{content:'';position:absolute;bottom:8px;right:8px;width:15px;height:15px;border-bottom:3px solid rgba(255,255,255,.8);border-right:3px solid rgba(255,255,255,.8);border-radius:2px}
.edit-mode .del-btn,.edit-mode .resize-handle{display:block}
.loader {border: 4px solid rgba(255, 255, 255, 0.1);border-left-color: #fff;border-radius: 50%;width: 30px;height: 30px;animation: spin 1s linear infinite;}
@keyframes spin {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}

/* --- APP WINDOW --- */
.aw{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;transform:translate3d(100%,0,0);transition:transform .4s cubic-bezier(.19,1,.22,1);pointer-events:auto;overflow:hidden;display:flex;flex-direction:column;z-index:50}
.aw.ac{transform:translate3d(0,0,0)}
/* App Content Container: Fixed to be black so text is visible */
.awc{width:100%;height:100%;overflow:hidden;background:#000;position:relative} 
.aif{width:100%;height:100%;border:none;display:block;background:#fff;}

/* --- SWITCHER --- */
.as{position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;z-index:40;display:none;flex-direction:row;align-items:center;overflow-x:auto;overflow-y:hidden;white-space:nowrap;scroll-snap-type:x mandatory;padding:0 20px;pointer-events:auto; -webkit-overflow-scrolling: touch;}
.sc{display:flex;height:100%;align-items:center;gap:20px;min-width:min-content}
.scd{position:relative;width:75vw;max-width:300px;height:70vh;background:#1c1c1e;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.5);scroll-snap-align:center;flex-shrink:0;overflow:hidden;transform:scale(1);transition:transform 0.1s}
.ch{position:absolute;top:0;left:0;width:100%;height:40px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(5px);z-index:20;pointer-events:none}
/* Touch Layer on Cards */
.ctl{position:absolute;top:40px;left:0;width:100%;height:calc(100% - 40px);z-index:200;} 
.rcx{position:absolute;top:50px;right:20px;width:30px;height:30px;background:rgba(60,60,60,.8);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;cursor:pointer;z-index:200;display:none}

/* UI */
#edit-ui{position:fixed;bottom:40px;left:20px;right:20px;height:50px;display:flex;justify-content:center;gap:15px;z-index:200;pointer-events:none;opacity:0;transition:opacity .3s}
.edit-mode #edit-ui{opacity:1;pointer-events:auto}
button.ui-btn{padding:10px 20px;background:rgba(255,255,255,.2);backdrop-filter:blur(10px);border:none;border-radius:20px;color:#fff;font-weight:600;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.3)}
#add-panel{position:fixed;bottom:-400px;left:0;width:100%;height:350px;background:#1c1c1e;border-radius:20px 20px 0 0;z-index:300;transition:bottom .3s;padding:20px;display:flex;flex-direction:column;gap:10px}
#add-panel.open{bottom:0}
.add-opt{padding:15px;background:#2c2c2e;color:#fff;border-radius:12px;display:flex;align-items:center;gap:10px;font-size:16px;cursor:pointer}

/* INTERNAL APPS - Styled for Dark Mode */
.tc{padding:60px 20px;color:#fff;text-align:center;background:#000;height:100%;width:100%}.fb{padding:5px 10px;background:#007aff;border-radius:5px;border:none;color:white}
</style>
</head>
<body>

<div class="p" id="phone">
    <div class="s">
        <div class="sb"><span id="c">17:55</span><span id="batt">100%</span></div>
        <div class="h" id="h"><div id="ag"></div></div>
        <div class="aw" id="app-window"><div class="awc" id="awc"></div></div>
        <div class="as" id="switcher"><div class="sc" id="scc"></div></div>
        <div id="rcb" class="rcx" onclick="closeSwitcher()">‚úï</div>
        <div id="edit-ui">
            <button class="ui-btn" onclick="openAddPanel()">+ Widget</button>
            <button class="ui-btn" style="background:#007aff" onclick="toggleEdit(false)">Done</button>
        </div>
        <div class="hi" id="hi"></div>
    </div>
</div>

<div id="add-panel">
    <h3 style="color:#fff;margin-bottom:10px">Add Widget</h3>
    <div class="add-opt" onclick="addWidget('clock')">‚è∞ Clock</div>
    <div class="add-opt" onclick="addWidget('weather')">‚òÅÔ∏è Weather</div>
    <div class="add-opt" onclick="addWidget('calendar')">üìÖ Calendar</div>
    <div class="add-opt" onclick="addWidget('photo')">üñºÔ∏è Photo</div>
    <div class="add-opt" style="background:#3a3a3c;justify-content:center" onclick="closeAddPanel()">Cancel</div>
</div>

<script>
// --- CONFIG ---
const c=4,R=100;
let S=document.getElementById("ag").clientWidth||window.innerWidth;
let C=S/c;
let E=false;
let I=[]; 
let A=[]; 
let U=null; 
let M=false;
const K='os_layout_final_v3';

// --- INITIAL LAYOUT ---
const D=[
    { "title": "üéÆ Grapple Ascent", "icon": "üéÆ", "path": "page3.html", "class": "motion" },
    { "title": "üßÆ Smart Calculator", "icon": "üßÆ", "path": "page4.html", "class": "torch" },
    { "title": "ü§ñ AI Learning Platform", "icon": "ü§ñ", "path": "page6.html", "class": "speaker" },
    { "title": "üì∞ News Reader Pro", "icon": "üì∞", "path": "page9.html", "class": "news" },
    { "title": "‚è±Ô∏è Cycle Counter", "icon": "‚è±Ô∏è", "path": "page11.html", "class": "touch" },
    { "title": "üé® Theme Switcher", "icon": "üé®", "path": "page13.html", "class": "speaker" },
    { "title": "üóÉÔ∏è Files Manager", "icon": "üóÉÔ∏è", "path": "page17.html", "class": "camera" },
    { "title": "‚ò†Ô∏è Mortis Cloud", "icon": "‚ò†Ô∏è", "path": "page67.html", "class": "camera" },
    { "title": "üí¨ Secure Chat", "icon": "üí¨", "path": "page69.html", "class": "mic" },
    { "title": "üöß Test Page 3000", "icon": "üöß", "path": "page3000.html", "class": "test" },
    { "title": "‚öôÔ∏è Settings", "icon": "‚öôÔ∏è", "path": "settings.html", "class": "settings" }
];

function i(){
    u();setInterval(u,1000);
    const s=localStorage.getItem(K);
    if(s){
        try{
            JSON.parse(s).forEach(e=>g(e.type,e.x,e.y,e.cols,e.rows,e));
        }catch(e){d();}
    }else{
        d();
    }
    const e=document.getElementById("hi");
    let t=0;
    e.addEventListener("touchstart",e=>{t=e.touches[0].clientY;e.stopPropagation();},{passive:false});
    e.addEventListener("touchend",e=>{if(e.changedTouches[0].clientY-t<-30)h();},{passive:false});
    const r=document.getElementById("ag");
    let o;
    r.addEventListener("touchstart",e=>{
        if(e.target===r||e.target.classList.contains('aiw')){
            o=setTimeout(()=>p(true),800);
        }
    });
    r.addEventListener("touchend",()=>clearTimeout(o));
}

function d(){
    g('widget',0,0,2,2,{subtype:'clock'});
    g('widget',2*C,0,2,2,{subtype:'weather'});
    let e=2; 
    D.forEach((t,r)=>{
        const o=r%4;
        const s=e+Math.floor(r/4);
        g('app',o*C,s*R,1,1,t);
    });
    s();
}

function s(){
    const e=I.map(i=>({
        type:i.type,subtype:i.subtype,x:i.x,y:i.y,cols:i.cols,rows:i.rows,
        title:i.title,icon:i.icon,path:i.path,class:i.class
    }));
    localStorage.setItem(K,JSON.stringify(e));
}

function h(){
    if(U){m();o();}
    else if(M){f();}
    else if(A.length>0&&!E){o();}
}

// --- GRID ENGINE ---
function g(e,t,r,o,s,a={}){
    const n=document.createElement("div");
    n.classList.add("grid-item");
    const l=o*C-(e==="app"?0:15);
    const d=s*R-(e==="app"?10:15);

    if(e==="app"){
        n.classList.add("aiw");
        n.innerHTML=`<div class="ai ${a.class||'files'}">${a.icon}</div><div class="al">${a.title}</div>`;
        n.onclick=()=>{if(!E)j(a);};
    }else{
        n.classList.add("widget");
        n.innerHTML=`<div class="del-btn">√ó</div><div class="resize-handle"></div><div class="widget-content">${a.subtype==='loading'?'<div class="loader"></div>':w(a.subtype,o)}</div>`;
        n.querySelector(".del-btn").onclick=e=>{e.stopPropagation();z(n);};
    }
    document.getElementById("ag").appendChild(n);
    const p={ 
        el:n,type:e,subtype:a.subtype, 
        x:t,y:r,w:l,h:d,cols:o,rows:s,
        title:a.title,icon:a.icon,path:a.path,class:a.class
    };
    v(p);
    b(p);
    if(e==="widget")rZ(p);
    I.push(p);
    cI(p);
    return p;
}

function addWidget(e){
    cP();
    const t=fN(2,2);
    const r=g("widget",t.x,t.y,2,2,{subtype:"loading"});
    rE(r);v(r);p(true);
    setTimeout(()=>{
        r.subtype=e;
        r.el.querySelector(".widget-content").innerHTML=w(e,2);
        if(e==='clock')u();
        rE(r);v(r);s();
    },1000);
}

function w(e,t){
    if(e==="clock")return`<h1 style="margin:0;font-size:${t>=3?"48px":"34px"};font-weight:300" id="w-clock">${new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</h1><div style="font-size:11px;opacity:0.7;margin-top:-2px;letter-spacing:1px">NEW YORK</div>`;
    if(e==="weather")return`<div style="font-size:35px;margin-bottom:5px">‚õàÔ∏è</div><div style="font-size:22px;font-weight:bold">16¬∞</div><div style="font-size:11px;opacity:0.7">Heavy Rain</div>`;
    if(e==="photo")return'<img src="https://images.unsplash.com/photo-1494548162494-384bba4ab999?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" style="width:100%;height:100%;object-fit:cover;border-radius:20px;">';
    if(e==="calendar")return`<div style="color:#ff3b30;font-weight:bold;font-size:20px">DEC</div><div style="font-size:40px">2</div>`;
    return"Widget";
}

// --- APP LOGIC ---
function j(e){
    let t=A.find(t=>t.path===e.path);
    if(!t){
        t={...e,dom:k(e)};
        A.push(t);
    }
    y(t);

    const r=document.getElementById("awc");
    r.innerHTML=''; 
    r.appendChild(t.dom);
    
    requestAnimationFrame(()=>{
        document.getElementById("app-window").classList.add("ac");
        document.getElementById("h").classList.add("zo");
    });
    U=t;
    if(M)f();
}

// --- FIXED: UNIVERSAL FILE LOADER ---
function k(e){
    const t=document.createElement("div");
    t.style.width="100%";t.style.height="100%";

    // Only Settings is special because of the internal JS Reset button
    if(e.path==="settings.html"){
        t.innerHTML=`<div class="tc"><div style="font-size:60px;margin-bottom:20px">‚öôÔ∏è</div><h2>Settings</h2><br><button class="fb db" onclick="r()">Reset Home Layout</button></div>`;
    } else {
        // EVERYTHING else (page3.html, page9.html, http, etc) gets loaded as a file
        const r=document.createElement("iframe");
        r.className="aif";
        r.src=e.path; 
        t.appendChild(r);
    }
    return t;
}

function r(){
    if(confirm("Reset layout to default?")){
        localStorage.removeItem(K);
        location.reload();
    }
}

function m(){
    if(!U)return;
    document.getElementById("app-window").classList.remove("ac");
    document.getElementById("h").classList.remove("zo");
    U=null;
}

function t(e){
    const t=A.indexOf(e);
    if(t>-1){A.splice(t,1);e.dom.remove();if(e.cardEl)e.cardEl.remove();}
    if(A.length===0)f();
}

// --- FIXED: SWITCHER SHOWS ACTUAL APPS ---
function o(){
    M=true;
    const e=document.getElementById("switcher");
    const t=document.getElementById("scc");
    const r=document.getElementById("h");
    e.style.display='flex';
    document.getElementById("rcb").style.display='flex';
    r.classList.add("zo");
    t.innerHTML='';
    A.forEach(e=>{
        const r=document.createElement("div");
        r.className="scd";
        const o=document.createElement("div");
        o.className="ch";
        o.innerHTML=`<span style="color:#fff;font-size:12px;font-weight:bold">${e.title}</span>`;
        r.appendChild(o);
        
        const s=document.createElement("div");
        s.className = 'contentHolder';
        // Black background for iframe apps
        s.style.cssText = "width:100%;height:100%;pointer-events:none;padding-top:40px;background:#000;position:relative;";
        
        // Move the LIVE app (iframe) into the card
        if(e.dom.parentNode)e.dom.parentNode.removeChild(e.dom);
        s.appendChild(e.dom);
        
        r.appendChild(s);
        
        const a=document.createElement("div");
        a.className="ctl";
        r.appendChild(a);
        x(a,r,e);
        t.appendChild(r);
        e.cardEl=r; 
    });
}

function y(e){
    if(e.dom.parentNode)e.dom.parentNode.removeChild(e.dom);
}

function f(){
    M=false;
    document.getElementById("switcher").style.display='none';
    document.getElementById("rcb").style.display='none';
    document.getElementById("h").classList.remove("zo");
}

function x(e,t,r){
    let o=0,s=0,a=false,n=false;
    
    e.addEventListener('touchstart',e=>{
        o=e.touches[0].clientX;
        s=e.touches[0].clientY;
        a=false;
        n=false;
    },{passive:false});

    e.addEventListener('touchmove',e=>{
        if(n)return; 
        
        const c=e.touches[0].clientX;
        const i=e.touches[0].clientY;
        const l=c-o;
        const d=i-s;

        if(!a&&!n){
            if(Math.abs(l)>Math.abs(d)&&Math.abs(l)>5){
                n=true;
            }else if(Math.abs(d)>Math.abs(l)&&Math.abs(d)>5){
                a=true;
            }
        }

        if(a){
            e.preventDefault(); 
            if(d<0){
                 t.style.transform=`scale(0.9) translateY(${d}px)`;
                 t.style.opacity=`${1-Math.abs(d)/500}`;
            }
        }
    },{passive:false});

    e.addEventListener('touchend',e=>{
        if(a){
            const d=e.changedTouches[0].clientY-s;
            if(d<-100){
                t.style.transition="transform 0.3s ease, opacity 0.3s";
                t.style.transform="translateY(-100vh)";
                t.style.opacity="0";
                setTimeout(()=>t(r),300);
            }else{
                t.style.transition="transform 0.2s ease, opacity 0.2s";
                t.style.transform="scale(1)";
                t.style.opacity="1";
            }
        }else if(!n){
             const d=e.changedTouches[0].clientY-s;
             const c=e.changedTouches[0].clientX-o;
             if(Math.abs(c)<10&&Math.abs(d)<10){
                 j(r);
             }
        }
    });
}

// --- UTILS ---
function v(e){
    const t=(e.cols*C-e.w)/2;
    const r=(e.rows*R-e.h)/2;
    e.el.style.left=(e.x+t)+"px";
    e.el.style.top=(e.y+r)+"px";
}

function rE(e){
    I.filter(t=>t!==e).forEach(t=>{
        if(rI(e,t)){
            const r=I.filter(e=>e!==t);
            const o=fN(t.cols,t.rows,r);
            t.x=o.x;t.y=o.y;
            v(t);
        }
    });
}

function rI(e,t){
    const r=10;
    return(e.x+r<t.x+t.cols*C)&&(e.x+e.cols*C-r>t.x)&&
           (e.y+r<t.y+t.rows*R)&&(e.y+t.rows*R-r>t.y);
}

function fN(e,t,r=I){
    let o=0;
    while(true){
        for(let s=0;s<c;s++){
            if(s+e>c)continue; 
            const a=s*C;const n=o*R;
            const l=r.some(t=>a<t.x+t.cols*C&&a+e*C>t.x&&n<t.y+t.rows*R&&n+t*R>t.y);
            if(!l)return{x:a,y:n};
        }
        o++;if(o>500)return{x:0,y:0};
    }
}

function cI(e){
    let t=0;I.forEach(e=>{const r=e.y+e.h;if(r>t)t=r;});
    document.getElementById("ag").style.minHeight=(t+300)+"px";
}

function p(t){E=t;document.body.classList.toggle("edit-mode",t);cP();}

function openAddPanel(){document.getElementById("add-panel").classList.add("open");}

function closeAddPanel(){document.getElementById("add-panel").classList.remove("open");}
function cP(){document.getElementById("add-panel").classList.remove("open");}
function toggleEdit(v){p(v);}

function z(e){ 
    const t=I.findIndex(t=>t.el===e); 
    if(t>-1){I.splice(t,1);e.remove();cI();s();} 
}

function u(){ 
    const e=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); 
    document.getElementById("c").innerText=e; 
    document.querySelectorAll("#w-clock").forEach(t=>t.innerText=e); 
}

// --- DRAG/RESIZE HANDLERS ---
function b(e){
    let t,r,o,s;
    const a=(a)=>{
        if(E&&!a.target.className.includes("resize-handle")&&!a.target.className.includes("del-btn")){
            a.preventDefault();e.el.classList.add("dragging");
            t=a.touches?a.touches[0].clientX:a.clientX;r=a.touches?a.touches[0].clientY:a.clientY;
            o=parseFloat(e.el.style.left);s=parseFloat(e.el.style.top);
            document.addEventListener("touchmove",n,{passive:false});document.addEventListener("touchend",l);
            document.addEventListener("mousemove",n);document.addEventListener("mouseup",l);
        }
    };
    const n=(t)=>{
        t.preventDefault();const r=t.touches?t.touches[0].clientX:t.clientX;const a=t.touches?t.touches[0].clientY:t.clientY;
        e.el.style.left=o+(r-t)+"px";e.el.style.top=s+(a-r)+"px";
    };
    const l=()=>{
        document.removeEventListener("touchmove",n);document.removeEventListener("touchend",l);
        document.removeEventListener("mousemove",n);document.removeEventListener("mouseup",l);
        e.el.classList.remove("dragging");
        const t=parseFloat(e.el.style.left);const r=parseFloat(e.el.style.top);
        let o=Math.round(t/C);let s=Math.round(r/R);
        if(o<0)o=0;if(o>c-e.cols)o=c-e.cols;if(s<0)s=0;
        e.x=o*C;e.y=s*R;
        rE(e);v(e);cI();s();
    };
    e.el.addEventListener("touchstart",a,{passive:false});e.el.addEventListener("mousedown",a);
}

function rZ(e){
    const t=e.el.querySelector(".resize-handle");
    let r,o,s,a;
    const n=(n)=>{
        n.stopPropagation();n.preventDefault();e.el.classList.add("resizing");
        r=n.touches?n.touches[0].clientX:n.clientX;o=n.touches?n.touches[0].clientY:n.clientY;
        s=e.w;a=e.h;
        document.addEventListener("touchmove",l,{passive:false});document.addEventListener("touchend",d);
        document.addEventListener("mousemove",l);document.addEventListener("mouseup",d);
    };
    const l=(t)=>{
        t.preventDefault();const r=t.touches?t.touches[0].clientX:t.clientX;const o=t.touches?t.touches[0].clientY:t.clientY;
        let n=Math.round((s+(r-t))/C);let l=Math.round((a+(o-r))/R);
        if(n<1)n=1;if(n>4)n=4;if(l<1)l=1;if(l>6)l=6;
        const p=n*C-15;const h=l*R-15;
        e.el.style.width=p+"px";e.el.style.height=h+"px";
        if(n!==e.cols||l!==e.rows){
            e.cols=n;e.rows=l;e.w=p;e.h=h;
            if(e.subtype!=='loading')e.el.querySelector(".widget-content").innerHTML=w(e.subtype,e.cols);
            if(e.subtype==="clock")u();
            rE(e);v(e);cI();
        }
    };
    const d=()=>{
        document.removeEventListener("touchmove",l);document.removeEventListener("touchend",d);
        document.removeEventListener("mousemove",l);document.removeEventListener("mouseup",d);
        e.el.classList.remove("resizing");v(e);s();
    };
    t.addEventListener("touchstart",n,{passive:false});t.addEventListener("mousedown",n);
}

window.addEventListener("resize",()=>{
    S=document.getElementById("ag").clientWidth||window.innerWidth;
    C=S/c;
    I.forEach(e=>{
        const t=Math.round(e.x/(S/c)); 
        e.x=t*C;e.w=e.cols*C-(e.type==="app"?0:15);
        v(e);
    });
});
i();
</script>
</body>
</html>
