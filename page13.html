<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Class-Based Theme Switcher</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- MANDATORY: Load the single Master CSS file containing all themes -->
    <link rel="stylesheet" href="dlc_master.css">

    <!-- Third-Party Library for ZIP Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        /* Base styles applied to ensure Tailwind is overridden correctly */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; 
            color: #c9d1d9; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: background-color 0.5s ease-in-out, color 0.5s ease-in-out;
        }
        
        /* Base Vibe style */
        .vibe {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
            color: #58a6ff; 
            transition: all 0.5s ease-in-out;
        }

        .sub {
            color: #8b949e;
        }

        /* Styling for the main content area */
        .stage {
            position: relative;
            max-width: 90%;
            width: 500px;
            padding: 2rem;
            margin: 1rem;
            background-color: #161b22;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        /* Custom select styling for better touch target on mobile */
        #theme-selector {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23C9D1D9'%3E%3Cpath d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0l-4.25-4.25a.75.75 0 01.02-1.06z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            cursor: pointer;
        }
    </style>
    
</head>
<body class="p-4">

    <!-- Theme Selection Control -->
    <div class="mb-8 w-full max-w-sm text-center">
        <label for="theme-selector" class="block text-lg font-medium mb-2 sub">Select Theme (31 Options):</label>
        <select id="theme-selector" class="w-full bg-gray-800 border border-gray-700 text-white py-3 px-4 pr-10 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-300">
            <!-- Options will be generated by JavaScript based on themeData array -->
        </select>
    </div>

    <!-- Content Stage to show the theme change -->
    <div class="stage text-center">
        <div class="vibe">SYSTEM ONLINE</div>
        <p class="sub text-sm mt-4">This text and the background are dynamically styled by the selected theme.</p>
        <button id="open-grid-btn" class="mt-6 w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
            Click to Cycle Theme
        </button>
        <button id="download-themes-btn" class="mt-4 w-full py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg shadow-lg transition duration-300">
            Download All 31 Themes as ZIP
        </button>
    </div>

    <script>
        // --- EMBEDDED MASTER CSS CONTENT ---
        // This is the complete, original dlc_master.css content, embedded as a string.
        const MASTER_CSS_CONTENT = `
/*
 * MASTER THEME LIBRARY (dlc_master.css)
 * Contains 30 unique themes, switched dynamically by applying a class
 * to the <body> element (e.g., <body class="theme-dlc-1">).
 */

/* --- Keyframe Animations (Required for Glitch and Flicker) --- */

@keyframes text-glitch {
    0% { transform: skewX(-5deg) translate(0px, 0px); filter: hue-rotate(0deg); }
    40% { transform: skewX(2deg) translate(-1px, 1px); }
    50% { transform: skewX(-1deg) translate(2px, -1px); }
    60% { transform: skewX(1deg) translate(-2px, 2px); }
    100% { transform: skewX(-5deg) translate(0px, 0px); filter: hue-rotate(360deg); }
}

@keyframes screen-flicker {
    0%, 100% { opacity: 1; }
    5% { opacity: 0.9; }
    10% { opacity: 1; }
    15% { opacity: 0.8; }
    20% { opacity: 1; }
    25% { opacity: 0.95; }
    30% { opacity: 1; }
}


/*
 * ===========================================
 * DLC 1: Cyber-Glitch Overload (Default Master)
 * ===========================================
 */
body.theme-dlc-1 {
    background-image: repeating-linear-gradient(45deg, rgba(0,0,0,.08) 0px, rgba(0,0,0,.08) 1px, transparent 1px, transparent 20px),
                      linear-gradient(to bottom, #111 0%, #000 100%) !important;
    background-size: 100% !important;
    color: #00ffff !important;
    transition: background-color 0.8s ease-in-out, color 0.8s ease-in-out !important;
}
body.theme-dlc-1 .vibe {
    animation: text-glitch 0.5s infinite alternate !important;
    text-transform: uppercase !important;
    font-style: italic !important;
    transform: skewX(-5deg) !important;
    color: #ff00ff !important;
    transition: all 0.2s ease-in-out !important;
}
body.theme-dlc-1 #open-grid-btn {
    background: #ff00ff !important;
    color: #000000 !important;
    border: 3px solid #00ffff !important;
    box-shadow: 0 0 10px #ff00ff, 0 0 20px #00ffff !important;
    font-weight: 900 !important;
    padding: 12px 25px !important;
}
body.theme-dlc-1 .stage {
    border: 1px solid #00ffff !important;
    background-color: rgba(17, 17, 17, 0.9) !important;
}


/*
 * ===========================================
 * DLC 2: Vaporwave / Retro VHS
 * ===========================================
 */
body.theme-dlc-2 {
    background: #200020 !important;
    transition: none !important;
}
body.theme-dlc-2::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
    background: repeating-linear-gradient(
        transparent 0,
        rgba(0, 0, 0, 0.3) 1px,
        transparent 2px,
        transparent 4px
    );
    opacity: 0.5;
}
body.theme-dlc-2 .vibe, body.theme-dlc-2 .sub {
    text-shadow: 2px 0 0 rgba(255, 0, 0, 0.7), -2px 0 0 rgba(0, 255, 255, 0.7) !important;
    filter: blur(0.5px) contrast(120%) saturate(150%) hue-rotate(5deg) !important;
    transition: none !important;
    font-family: 'Courier New', Courier, monospace !important;
    color: #ff00ff !important;
}
body.theme-dlc-2 .stage {
    background-color: rgba(32, 0, 32, 0.8) !important;
    border: 3px solid #ff00ff !important;
    box-shadow: 0 0 15px #00ffff !important;
    animation: screen-flicker 10s steps(1) infinite !important;
}
body.theme-dlc-2 #open-grid-btn {
    background: linear-gradient(90deg, #ff00ff, #00ffff) !important;
    color: white !important;
    border: none !important;
    text-shadow: 1px 1px 0 #000 !important;
}


/*
 * ===========================================
 * DLC 3: Neon City Bright
 * ===========================================
 */
body.theme-dlc-3 { background-color: #f0f0f0 !important; color: #333 !important; }
body.theme-dlc-3 .vibe { color: #FF10F0 !important; text-shadow: 0 0 10px rgba(255, 16, 240, 0.8) !important; font-weight: 900 !important; }
body.theme-dlc-3 .stage { background-color: #ffffff !important; border: 2px solid #00E4FF !important; box-shadow: 0 0 15px rgba(0, 228, 255, 0.5) !important; }
body.theme-dlc-3 #open-grid-btn { background: #00E4FF !important; color: #111 !important; border: none !important; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important; }


/*
 * ===========================================
 * DLC 4: Deep Space Noir
 * ===========================================
 */
body.theme-dlc-4 { background: linear-gradient(180deg, #000000 0%, #030a13 100%) !important; color: #b0c4de !important; }
body.theme-dlc-4 .vibe { color: #7b24ff !important; font-size: 2.8rem !important; font-style: normal !important; }
body.theme-dlc-4 .stage { background-color: rgba(5, 12, 20, 0.95) !important; border-left: 5px solid #7b24ff !important; box-shadow: 0 0 20px rgba(0, 0, 0, 0.9) !important; }
body.theme-dlc-4 #open-grid-btn { background: #1e1e2d !important; color: #7b24ff !important; border: 1px solid #7b24ff !important; }


/*
 * ===========================================
 * DLC 5: Forest Canopy
 * ===========================================
 */
body.theme-dlc-5 { background-color: #2e463f !important; color: #c0c7a5 !important; }
body.theme-dlc-5 .vibe { color: #9cb95e !important; font-weight: 600 !important; }
body.theme-dlc-5 .stage { background-color: #3d5a4d !important; border-radius: 4px !important; box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3) !important; }
body.theme-dlc-5 #open-grid-btn { background: #5b7f58 !important; color: #fff !important; border: none !important; font-weight: 500 !important; }


/*
 * ===========================================
 * DLC 6: Desert Sunset
 * ===========================================
 */
body.theme-dlc-6 { background: linear-gradient(180deg, #8b3a3a 0%, #cc9966 100%) !important; color: #f7e6c4 !important; }
body.theme-dlc-6 .vibe { color: #ffcc00 !important; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4) !important; }
body.theme-dlc-6 .stage { background-color: rgba(179, 78, 59, 0.85) !important; border-top: 4px solid #ffcc00 !important; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5) !important; }
body.theme-dlc-6 #open-grid-btn { background: #ff7f50 !important; color: white !important; font-weight: 700 !important; }


/*
 * ===========================================
 * DLC 7: Monochrome Blueprint
 * ===========================================
 */
body.theme-dlc-7 { background-color: #0d223f !important; color: #dddddd !important; }
body.theme-dlc-7 .vibe { color: #ffffff !important; letter-spacing: 0.1em !important; font-family: monospace !important; }
body.theme-dlc-7 .stage { background-color: #1a385b !important; border: 1px dashed #ffffff !important; }
body.theme-dlc-7 .stage::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: linear-gradient(to right, #ffffff33 1px, transparent 1px),
                      linear-gradient(to bottom, #ffffff33 1px, transparent 1px);
    background-size: 20px 20px;
    opacity: 0.1;
    pointer-events: none;
    border-radius: 12px;
    z-index: 0;
}
body.theme-dlc-7 #open-grid-btn { background: #0088ff !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 8: High Contrast Accessibility
 * ===========================================
 */
body.theme-dlc-8 { background-color: #000000 !important; color: #ffffff !important; }
body.theme-dlc-8 .vibe { color: #ffff00 !important; font-weight: bold !important; text-transform: uppercase !important; }
body.theme-dlc-8 .stage { background-color: #000000 !important; border: 3px solid #ffffff !important; box-shadow: none !important; }
body.theme-dlc-8 .sub { color: #ffffff !important; }
body.theme-dlc-8 #open-grid-btn { background: #ffffff !important; color: #000000 !important; border: 3px solid #ffff00 !important; font-weight: 800 !important; }


/*
 * ===========================================
 * DLC 9: Lava Flow Dark
 * ===========================================
 */
body.theme-dlc-9 { background-color: #1a0000 !important; color: #ff9933 !important; }
body.theme-dlc-9 .vibe { color: #ff3300 !important; text-shadow: 0 0 10px rgba(255, 51, 0, 0.7) !important; }
body.theme-dlc-9 .stage { background-color: rgba(26, 0, 0, 0.9) !important; border-top: 5px solid #ff3300 !important; box-shadow: 0 0 15px rgba(255, 51, 0, 0.3) !important; }
body.theme-dlc-9 #open-grid-btn { background: linear-gradient(180deg, #ff3300, #990000) !important; color: white !important; border: none !important; transition: background 0.2s !important; }


/*
 * ===========================================
 * DLC 10: Aqua Dream Light
 * ===========================================
 */
body.theme-dlc-10 { background-color: #e0ffff !important; color: #005555 !important; }
body.theme-dlc-10 .vibe { color: #00bcd4 !important; font-weight: 700 !important; }
body.theme-dlc-10 .stage { background-color: #ffffff !important; border: 1px solid #00bcd4 !important; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important; }
body.theme-dlc-10 .sub { color: #008080 !important; }
body.theme-dlc-10 #open-grid-btn { background: #00bcd4 !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 11: Steampunk Brass
 * ===========================================
 */
body.theme-dlc-11 { background-color: #4b3832 !important; color: #f7f3e0 !important; }
body.theme-dlc-11 .vibe { color: #cc9933 !important; font-family: serif !important; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5) !important; }
body.theme-dlc-11 .stage { background-color: #5e473e !important; border: 2px ridge #996633 !important; border-radius: 0 !important; }
body.theme-dlc-11 #open-grid-btn { background: #996633 !important; color: #f7f3e0 !important; border: 1px solid #cc9933 !important; box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5) !important; }


/*
 * ===========================================
 * DLC 12: Matrix Code Green
 * ===========================================
 */
body.theme-dlc-12 { background-color: #000000 !important; color: #00ff41 !important; }
body.theme-dlc-12 .vibe { color: #00ff41 !important; font-family: monospace !important; text-shadow: 0 0 10px #00ff41 !important; }
body.theme-dlc-12 .stage { background-color: rgba(0, 0, 0, 0.95) !important; border: 1px solid #00ff41 !important; box-shadow: 0 0 20px #00ff41 !important; }
body.theme-dlc-12 #open-grid-btn { background: #00ff41 !important; color: black !important; border: none !important; font-weight: 900 !important; }


/*
 * ===========================================
 * DLC 13: Crimson Midnight
 * ===========================================
 */
body.theme-dlc-13 { background-color: #0a0000 !important; color: #ff4545 !important; }
body.theme-dlc-13 .vibe { color: #ff0000 !important; font-weight: 600 !important; letter-spacing: 0.05em !important; }
body.theme-dlc-13 .stage { background-color: #1e0000 !important; border-bottom: 5px solid #ff0000 !important; box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3) !important; }
body.theme-dlc-13 #open-grid-btn { background: #ff0000 !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 14: Candy Pop Pink
 * ===========================================
 */
body.theme-dlc-14 { background-color: #ffe6f0 !important; color: #333333 !important; }
body.theme-dlc-14 .vibe { color: #ff69b4 !important; font-style: italic !important; text-transform: capitalize !important; }
body.theme-dlc-14 .stage { background-color: #ffffff !important; border: 3px dashed #87cefa !important; box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3) !important; }
body.theme-dlc-14 #open-grid-btn { background: #87cefa !important; color: white !important; border: none !important; transition: transform 0.1s ease-in-out !important; }
body.theme-dlc-14 #open-grid-btn:hover { transform: scale(1.05) !important; }


/*
 * ===========================================
 * DLC 15: Ocean Abyss Blue
 * ===========================================
 */
body.theme-dlc-15 { background: #000022 !important; color: #a0d8f0 !important; }
body.theme-dlc-15 .vibe { color: #1e90ff !important; font-weight: 300 !important; }
body.theme-dlc-15 .stage { background-color: #001f3f !important; border: 1px solid #1e90ff !important; box-shadow: 0 0 10px rgba(30, 144, 255, 0.5) !important; }
body.theme-dlc-15 #open-grid-btn { background: #0077b6 !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 16: Grungy Industrial
 * ===========================================
 */
body.theme-dlc-16 { 
    background-color: #333333 !important; 
    background-image: repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(0,0,0,0.2) 1px, rgba(0,0,0,0.2) 2px) !important;
    color: #e0e0e0 !important;
}
body.theme-dlc-16 .vibe { color: #a0522d !important; font-family: 'Arial Black', sans-serif !important; text-transform: uppercase !important; }
body.theme-dlc-16 .stage { background-color: #444444 !important; border: 3px outset #666666 !important; border-radius: 0 !important; }
body.theme-dlc-16 #open-grid-btn { background: #666666 !important; color: #111 !important; border: 2px solid #a0522d !important; box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5) !important; }


/*
 * ===========================================
 * DLC 17: Clean White Slate
 * ===========================================
 */
body.theme-dlc-17 { background-color: #ffffff !important; color: #333333 !important; }
body.theme-dlc-17 .vibe { color: #007bff !important; font-weight: 300 !important; }
body.theme-dlc-17 .stage { background-color: #f8f8f8 !important; border: 1px solid #dddddd !important; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important; }
body.theme-dlc-17 .sub { color: #666666 !important; }
body.theme-dlc-17 #open-grid-btn { background: #007bff !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 18: Paper Scroll Sepia
 * ===========================================
 */
body.theme-dlc-18 { background-color: #f7f0e0 !important; color: #4b3621 !important; font-family: serif !important; }
body.theme-dlc-18 .vibe { color: #7b4c27 !important; font-style: italic !important; text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.5) !important; }
body.theme-dlc-18 .stage { background-color: #fcf6e8 !important; border: 2px solid #7b4c27 !important; border-radius: 0 !important; box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.2) !important; }
body.theme-dlc-18 #open-grid-btn { background: #7b4c27 !important; color: #f7f0e0 !important; border: none !important; }


/*
 * ===========================================
 * DLC 19: Volcanic Ash Gray
 * ===========================================
 */
body.theme-dlc-19 { background-color: #444444 !important; color: #cccccc !important; }
body.theme-dlc-19 .vibe { color: #cc0000 !important; font-weight: 900 !important; }
body.theme-dlc-19 .stage { background-color: #303030 !important; border-top: 5px solid #cc0000 !important; box-shadow: 0 0 10px rgba(0, 0, 0, 0.6) !important; }
body.theme-dlc-19 #open-grid-btn { background: #666666 !important; color: #cc0000 !important; border: 2px solid #cc0000 !important; }


/*
 * ===========================================
 * DLC 20: Plasma Grid
 * ===========================================
 */
body.theme-dlc-20 { background-color: #0a0313 !important; color: #f0f0ff !important; }
body.theme-dlc-20 .vibe { color: #6600cc !important; text-shadow: 0 0 15px #00aaff !important; font-family: 'Consolas', monospace !important; }
body.theme-dlc-20 .stage { background-color: rgba(0, 0, 0, 0.7) !important; border: 1px solid #00aaff !important; box-shadow: 0 0 20px rgba(102, 0, 204, 0.7) !important; }
body.theme-dlc-20 #open-grid-btn { background: linear-gradient(45deg, #00aaff, #6600cc) !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 21: 8-Bit Arcade
 * ===========================================
 */
body.theme-dlc-21 { background-color: #1d1d1d !important; color: #e0e0e0 !important; font-family: 'Pixelated', monospace !important; }
body.theme-dlc-21 .vibe { color: #ff0000 !important; text-shadow: 2px 2px 0 #000 !important; letter-spacing: 0.15em !important; font-size: 3.2rem !important; }
body.theme-dlc-21 .stage { background-color: #2a2a2a !important; border: 4px solid #00ff00 !important; border-radius: 0 !important; box-shadow: 6px 6px 0 #0000ff !important; }
body.theme-dlc-21 #open-grid-btn { background: #00ff00 !important; color: #1d1d1d !important; border: 3px solid #ff0000 !important; font-weight: 900 !important; padding: 10px 20px !important; border-radius: 0 !important; }


/*
 * ===========================================
 * DLC 22: Gothic Velvet
 * ===========================================
 */
body.theme-dlc-22 { background-color: #1e002a !important; color: #d1b459 !important; }
body.theme-dlc-22 .vibe { color: #6a05ad !important; font-family: serif !important; font-style: normal !important; font-weight: 500 !important; }
body.theme-dlc-22 .stage { background-color: #2b1137 !important; border: 1px solid #6a05ad !important; box-shadow: 0 0 10px rgba(0, 0, 0, 0.8) !important; border-radius: 8px !important; }
body.theme-dlc-22 #open-grid-btn { background: #6a05ad !important; color: #d1b459 !important; border: none !important; }


/*
 * ===========================================
 * DLC 23: Art Deco Gold
 * ===========================================
 */
body.theme-dlc-23 { background-color: #f7f7f7 !important; color: #333333 !important; }
body.theme-dlc-23 .vibe { color: #ccad00 !important; font-family: 'Georgia', serif !important; text-transform: uppercase !important; }
body.theme-dlc-23 .stage { background-color: #ffffff !important; border: 5px double #000000 !important; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important; }
body.theme-dlc-23 #open-grid-btn { background: #000000 !important; color: #ccad00 !important; border: 2px solid #ccad00 !important; font-weight: 600 !important; }


/*
 * ===========================================
 * DLC 24: Holographic Shift
 * ===========================================
 */
body.theme-dlc-24 { background-color: #0f0f1a !important; color: #a0a0ff !important; }
body.theme-dlc-24 .vibe { 
    color: transparent !important; 
    background-image: linear-gradient(45deg, #ff00cc, #00ffff, #ffff00) !important; 
    -webkit-background-clip: text !important; 
    background-clip: text !important; 
    font-weight: 900 !important; 
}
body.theme-dlc-24 .stage { background-color: rgba(15, 15, 26, 0.9) !important; border: 1px solid #ff00cc !important; box-shadow: 0 0 20px rgba(0, 255, 255, 0.7) !important; }
body.theme-dlc-24 #open-grid-btn { background: linear-gradient(90deg, #ff00cc, #00ffff) !important; color: #0f0f1a !important; border: none !important; }


/*
 * ===========================================
 * DLC 25: Rainy Day Calm
 * ===========================================
 */
body.theme-dlc-25 { background-color: #c0c8d1 !important; color: #3c4a5c !important; }
body.theme-dlc-25 .vibe { color: #5d8aa8 !important; font-weight: 400 !important; }
body.theme-dlc-25 .stage { background-color: #e6e9ee !important; border: 1px solid #aebac7 !important; box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1) !important; }
body.theme-dlc-25 .sub { color: #607289 !important; }
body.theme-dlc-25 #open-grid-btn { background: #5d8aa8 !important; color: white !important; border: none !important; }


/*
 * ===========================================
 * DLC 26: Toxic Waste Green
 * ===========================================
 */
body.theme-dlc-26 { background-color: #000000 !important; color: #ccff33 !important; }
body.theme-dlc-26 .vibe { color: #ccff33 !important; text-shadow: 0 0 10px #ccff33 !important; font-weight: 800 !important; }
body.theme-dlc-26 .stage { background-color: #111111 !important; border: 3px solid #00cc00 !important; box-shadow: 0 0 25px rgba(204, 255, 51, 0.9) !important; }
body.theme-dlc-26 #open-grid-btn { background: #00cc00 !important; color: black !important; border: none !important; }


/*
 * ===========================================
 * DLC 27: Winter Frost Blue
 * ===========================================
 */
body.theme-dlc-27 { background-color: #e0f2f7 !important; color: #0a3d62 !important; }
body.theme-dlc-27 .vibe { color: #66ccff !important; font-weight: 200 !important; }
body.theme-dlc-27 .stage { background-color: #ffffff !important; border: 1px solid #66ccff !important; box-shadow: 0 0 15px rgba(102, 204, 255, 0.5) !important; }
body.theme-dlc-27 #open-grid-btn { background: #66ccff !important; color: #0a3d62 !important; border: none !important; }


/*
 * ===========================================
 * DLC 28: Ancient Stone Texture
 * ===========================================
 */
body.theme-dlc-28 { background-color: #4f4a41 !important; color: #e9e5d7 !important; font-family: serif !important; }
body.theme-dlc-28 .vibe { color: #9c978b !important; text-shadow: 1px 1px 0 #333 !important; text-transform: uppercase !important; }
body.theme-dlc-28 .stage { background-color: #6b665c !important; border: 5px groove #38342e !important; border-radius: 0 !important; }
body.theme-dlc-28 #open-grid-btn { background: #38342e !important; color: #e9e5d7 !important; border: none !important; font-weight: 700 !important; }


/*
 * ===========================================
 * DLC 29: Solar Flare Yellow
 * ===========================================
 */
body.theme-dlc-29 { background: linear-gradient(180deg, #ffdd00 0%, #ff6600 100%) !important; color: #333333 !important; }
body.theme-dlc-29 .vibe { color: #cc0000 !important; font-weight: 900 !important; text-shadow: 0 0 5px rgba(255, 255, 255, 0.8) !important; }
body.theme-dlc-29 .stage { background-color: #ffffff !important; border: 4px solid #ff6600 !important; box-shadow: 0 10px 30px rgba(255, 102, 0, 0.5) !important; }
body.theme-dlc-29 #open-grid-btn { background: #ff6600 !important; color: white !important; border: none !important; text-transform: uppercase !important; }


/*
 * ===========================================
 * DLC 30: Midnight Purple
 * ===========================================
 */
body.theme-dlc-30 { background-color: #1a102d !important; color: #d8c2ff !important; }
body.theme-dlc-30 .vibe { color: #8c52ff !important; font-weight: 500 !important; }
body.theme-dlc-30 .stage { background-color: #271a3d !important; border: 1px solid #8c52ff !important; box-shadow: 0 0 10px rgba(140, 82, 255, 0.4) !important; }
body.theme-dlc-30 #open-grid-btn { background: #8c52ff !important; color: white !important; border: none !important; }
`;

        // Data structure containing all 31 themes (Base + dlc_1 through dlc_30)
        const themeData = [
            { key: 'base', name: 'Base (Minimal Dark)' },
            { key: 'dlc-1', name: 'Cyber-Glitch Overload (dlc_1)' },
            { key: 'dlc-2', name: 'Vaporwave / Retro VHS (dlc_2)' },
            { key: 'dlc-3', name: 'Neon City Bright (dlc_3)' },
            { key: 'dlc-4', name: 'Deep Space Noir (dlc_4)' },
            { key: 'dlc-5', name: 'Forest Canopy (dlc_5)' },
            { key: 'dlc-6', name: 'Desert Sunset (dlc_6)' },
            { key: 'dlc-7', name: 'Monochrome Blueprint (dlc_7)' },
            { key: 'dlc-8', name: 'High Contrast Accessibility (dlc_8)' },
            { key: 'dlc-9', name: 'Lava Flow Dark (dlc_9)' },
            { key: 'dlc-10', name: 'Aqua Dream Light (dlc_10)' },
            { key: 'dlc-11', name: 'Steampunk Brass (dlc_11)' },
            { key: 'dlc-12', name: 'Matrix Code Green (dlc_12)' },
            { key: 'dlc-13', name: 'Crimson Midnight (dlc_13)' },
            { key: 'dlc-14', name: 'Candy Pop Pink (dlc_14)' },
            { key: 'dlc-15', name: 'Ocean Abyss Blue (dlc_15)' },
            { key: 'dlc-16', name: 'Grungy Industrial (dlc_16)' },
            { key: 'dlc-17', name: 'Clean White Slate (dlc_17)' },
            { key: 'dlc-18', name: 'Paper Scroll Sepia (dlc_18)' },
            { key: 'dlc-19', name: 'Volcanic Ash Gray (dlc_19)' },
            { key: 'dlc-20', name: 'Plasma Grid (dlc_20)' },
            { key: 'dlc-21', name: '8-Bit Arcade (dlc_21)' },
            { key: 'dlc-22', name: 'Gothic Velvet (dlc_22)' },
            { key: 'dlc-23', name: 'Art Deco Gold (dlc_23)' },
            { key: 'dlc-24', name: 'Holographic Shift (dlc_24)' },
            { key: 'dlc-25', name: 'Rainy Day Calm (dlc_25)' },
            { key: 'dlc-26', name: 'Toxic Waste Green (dlc_26)' },
            { key: 'dlc-27', name: 'Winter Frost Blue (dlc_27)' },
            { key: 'dlc-28', name: 'Ancient Stone Texture (dlc_28)' },
            { key: 'dlc-29', name: 'Solar Flare Yellow (dlc_29)' },
            { key: 'dlc-30', name: 'Midnight Purple (dlc_30)' }
        ];

        const THEME_CLASS_PREFIX = 'theme-dlc-';
        const themeSelector = document.getElementById('theme-selector');
        const themeButton = document.getElementById('open-grid-btn');
        const downloadButton = document.getElementById('download-themes-btn'); // New button
        const body = document.body;
        const THEME_KEYS = themeData.map(theme => theme.key); 
        
        // --- Core Theme Switching Functions (Unchanged) ---

        /**
         * Changes the application's theme dynamically by updating the body class.
         * Note: This assumes dlc_master.css is still loaded.
         * @param {string} themeKey The key of the theme to apply (e.g., 'dlc-1').
         */
        function setTheme(themeKey) {
            // 1. Clear previous theme classes from the body
            body.className = body.className.split(' ').filter(c => !c.startsWith(THEME_CLASS_PREFIX) && c !== '').join(' ');
            
            if (themeKey !== 'base') {
                // 2. Add the new theme class (removing the dash if present, as used in the CSS names)
                const themeClass = `${THEME_CLASS_PREFIX}${themeKey.replace('-', '')}`;
                body.classList.add(themeClass);
            }
            
            // 3. Update the dropdown selection
            themeSelector.value = themeKey; 
            console.log(`Theme set to: ${themeKey}`);
        }
        
        /**
         * Cycles through the available themes when the button is clicked.
         */
        function cycleTheme() {
            let currentIndex = THEME_KEYS.indexOf(themeSelector.value);
            let nextIndex = (currentIndex + 1) % THEME_KEYS.length;
            let nextThemeValue = THEME_KEYS[nextIndex];
            setTheme(nextThemeValue);
        }

        /**
         * Populates the theme selector dropdown with all available themes.
         */
        function populateThemeSelector() {
            const defaultKey = 'dlc-1'; 
            themeData.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme.key;
                option.textContent = theme.name;
                themeSelector.appendChild(option);
            });
            themeSelector.value = defaultKey; 
        }


        // --- NEW: ZIP GENERATION LOGIC ---

        /**
         * Parses the monolithic CSS content, splits it into separate files, 
         * creates a ZIP archive, and triggers a download.
         */
        async function splitAndDownloadThemes() {
            downloadButton.textContent = "Processing... Please wait.";
            downloadButton.disabled = true;

            const zip = new JSZip();
            
            // Step 1: Split the CSS into three main parts: Animations, Base, and DLCs
            const parts = MASTER_CSS_CONTENT.split('/* ===========================================');
            
            // The first part is the header, animations, and base styles
            const baseContent = parts[0].trim();
            
            // Regular expression to find the animation block
            const animationRegex = /(\/\* --- Keyframe Animations[\s\S]*?\/\* ===========================================|(\@keyframes text-glitch[\s\S]*\n\}))/g;
            
            // 1.1 Extract only the animations/base to put in a standalone base file
            let baseFileContent = baseContent;

            // 1.2 The base file will hold the animations and a clear header
            const animationsMatch = baseContent.match(animationRegex);
            let animationsBlock = "";
            if (animationsMatch) {
                // Combine all animation parts into a single block
                animationsBlock = animationsMatch.join('\n\n'); 
                // Remove animations from base content to create a clean base.css if needed, 
                // but we will put it all in one base file for simplicity here.
            }

            const masterBaseFileName = 'dlc_master_base.css';
            const masterBaseFileHeader = `/* DLC Master Base - Contains only shared animations and global resets */\n\n`;
            zip.file(masterBaseFileName, masterBaseFileHeader + animationsBlock);

            // 2. Process each remaining DLC segment (index 1 onwards)
            const dlcParts = parts.slice(1);
            let totalFiles = 1; // Start with the master base file
            
            dlcParts.forEach((part, index) => {
                const dlcNumber = index + 1;
                const dlcFileName = `theme-dlc-${dlcNumber}.css`;
                
                // Re-add the separator comment structure at the start of the part
                const fullDlcContent = `/* ===========================================${part.trim()}`;
                
                zip.file(dlcFileName, fullDlcContent);
                totalFiles++;
            });

            // 3. Generate the ZIP file and trigger download
            const zipFileName = "dlc_theme_segments.zip";
            const zipOptions = { type: "blob", compression: "DEFLATE", compressionOptions: { level: 9 } };
            
            zip.generateAsync(zipOptions).then(function(content) {
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = zipFileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                console.log(`Successfully generated and downloaded ${totalFiles} files in ${zipFileName}`);
            }).finally(() => {
                downloadButton.textContent = "Download All 31 Themes as ZIP";
                downloadButton.disabled = false;
            });
        }

        // --- Initialization and Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Generate all the <option> elements
            populateThemeSelector();

            // 2. Set the initial theme to the default ('dlc-1')
            setTheme(themeSelector.value);

            // 3. Listener for the DROPDOWN menu
            themeSelector.addEventListener('change', (event) => {
                const selectedKey = event.target.value;
                setTheme(selectedKey);
            });
            
            // 4. Listener for the CYCLE BUTTON
            themeButton.addEventListener('click', cycleTheme);
            
            // 5. Listener for the DOWNLOAD BUTTON
            downloadButton.addEventListener('click', splitAndDownloadThemes);

        });
    </script>
</body>
</html>
